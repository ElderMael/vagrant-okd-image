kind: Template
apiVersion: v1
parameters:
- name: PSK
  description: "The random private shared key for the VPN server"
  generate: expression
  from: "[a-zA-Z0-9]{12}"
- name: USERNAME
  description: "The random username for the VPN"
  generate: expression
  from: "[a-zA-Z0-9]{12}"
- name: PASSWORD
  description: "The random user password for the VPN"
  generate: expression
  from: "[a-zA-Z0-9]{12}"
objects:
- kind: Secret
  apiVersion: v1
  kind: Secret
  metadata:
    name: vpn
    namespace: tools
  type: Opaque
  data:
    psk: '${PSK}'
    username: '${USERNAME}'
    password: '${PASSWORD}'
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    annotations:
    openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    labels:
    app: docker-ipsec-vpn-server
    name: docker-ipsec-vpn-server
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
    app: docker-ipsec-vpn-server
    deploymentconfig: docker-ipsec-vpn-server
    strategy:
    activeDeadlineSeconds: 21600
    resources: {}
    rollingParams:
    intervalSeconds: 1
    maxSurge: 25%
    maxUnavailable: 25%
    timeoutSeconds: 600
    updatePeriodSeconds: 1
    type: Rolling
    template:
    metadata:
    annotations:
    openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
    app: docker-ipsec-vpn-server
    deploymentconfig: docker-ipsec-vpn-server
    spec:
      serviceAccountName: "userroot"
      containers:
      - env:
        - name: VPN_IPSEC_PSK
          valueFrom:
          secretKeyRef:
          key: psk
          name: vpn
        - name: VPN_USER
          valueFrom:
          secretKeyRef:
          key: username
          name: vpn
        - name: VPN_PASSWORD
          valueFrom:
          secretKeyRef:
          key: password
        name: vpn
        image: 172.30.1.1:5000/tools/docker-ipsec-vpn-server@sha256:6a38e66d5eaca10aba8378ea2f38a0838f7c58d2aae2ea1748b98619b00ca71f
        imagePullPolicy: Always
        name: docker-ipsec-vpn-server
        ports:
        - containerPort: 500
          protocol: UDP
        - containerPort: 4500
          protocol: UDP
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        test: false
        triggers:
        - type: ConfigChange
        - imageChangeParams:
          automatic: true
        containerNames:
        - docker-ipsec-vpn-server
          from:
          kind: ImageStreamTag
          name: docker-ipsec-vpn-server:latest
          namespace: tools
          type: ImageChange
